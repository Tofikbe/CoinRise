<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CoinRise - Demo Exchange</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#0d1117; color:#fff; }
    header { background:#161b22; padding:10px; text-align:center; font-size:20px; font-weight:bold; }
    nav { display:flex; justify-content:space-around; background:#161b22; padding:10px 0; }
    nav button { background:none; border:none; color:#fff; font-size:16px; }
    .active { color:#00c2ff; font-weight:bold; }
    .page { display:none; padding:15px; }
    .show { display:block; }
    .token-card { display:flex; justify-content:space-between; background:#1c2128; padding:10px; margin:5px 0; border-radius:8px; }
    .buy-sell { margin:15px 0; }
    button { padding:8px 12px; border:none; border-radius:6px; background:#00c2ff; color:#000; font-weight:bold; }
    input { padding:6px; border-radius:6px; border:1px solid #555; width:90%; margin:5px 0; }
    #chart { width:100%; height:200px; background:#111; margin-top:10px; }
    .success { color:#00ff88; font-size:14px; margin-top:5px; }
    .error { color:#ff4d4d; font-size:14px; margin-top:5px; }
  </style>
</head>
<body>
  <header>CoinRise - Demo Exchange</header>
  <nav>
    <button onclick="showPage('market')" id="nav-market" class="active">Market</button>
    <button onclick="showPage('trade')" id="nav-trade">Trade</button>
    <button onclick="showPage('assets')" id="nav-assets">Assets</button>
    <button onclick="showPage('profile')" id="nav-profile">Profile</button>
  </nav>

  <!-- Login Page -->
  <div id="login" class="page show">
    <h2>Login / Signup</h2>
    <input id="username" placeholder="Enter username" />
    <input id="password" type="password" placeholder="Enter password" />
    <button onclick="signup()">Signup</button>
    <button onclick="login()">Login</button>
    <div id="login-msg"></div>
  </div>

  <!-- Market Page -->
  <div id="market" class="page">
    <h2>Market</h2>
    <div id="token-list"></div>
  </div>

  <!-- Trade Page -->
  <div id="trade" class="page">
    <h2>Trade</h2>
    <select id="token-select"></select>
    <div id="chart"></div>
    <div class="buy-sell">
      <input id="trade-amount" type="number" placeholder="Amount (USDT)" />
      <button onclick="buyToken()">Buy</button>
      <button onclick="sellToken()">Sell</button>
      <div id="trade-msg"></div>
    </div>
  </div>

  <!-- Assets Page -->
  <div id="assets" class="page">
    <h2>My Assets</h2>
    <div id="balance"></div>
    <div id="holdings"></div>
  </div>

  <!-- Profile Page -->
  <div id="profile" class="page">
    <h2>Profile</h2>
    <div id="user-info"></div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    // Fake Tokens
    const tokens = [
      { symbol: "KING", price: 100 },
      { symbol: "GIVNIX", price: 50 },
      { symbol: "BGMI", price: 10 },
      { symbol: "PUBG", price: 5 }
    ];

    let user = null;
    let chartData = [];

    // Navigation
    function showPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('show'));
      document.getElementById(page).classList.add('show');
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById("nav-" + page).classList.add('active');
      if(page === "market") renderMarket();
      if(page === "trade") renderTrade();
      if(page === "assets") renderAssets();
      if(page === "profile") renderProfile();
    }

    // Signup
    function signup() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if(localStorage.getItem("user-" + u)) {
        document.getElementById("login-msg").innerHTML = "<p class='error'>User exists</p>";
      } else {
        const newUser = { username:u, password:p, balance:1000, holdings:{} };
        localStorage.setItem("user-" + u, JSON.stringify(newUser));
        document.getElementById("login-msg").innerHTML = "<p class='success'>Signup successful</p>";
      }
    }

    // Login
    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      const data = localStorage.getItem("user-" + u);
      if(!data) return document.getElementById("login-msg").innerHTML = "<p class='error'>No user found</p>";
      const obj = JSON.parse(data);
      if(obj.password !== p) return document.getElementById("login-msg").innerHTML = "<p class='error'>Wrong password</p>";
      user = obj;
      localStorage.setItem("current-user", u);
      document.getElementById("login").classList.remove('show');
      showPage('market');
    }

    // Logout
    function logout() {
      user = null;
      localStorage.removeItem("current-user");
      document.querySelectorAll('.page').forEach(p => p.classList.remove('show'));
      document.getElementById("login").classList.add('show');
    }

    // Render Market
    function renderMarket() {
      let html = "";
      tokens.forEach(t => {
        html += `<div class='token-card'><b>${t.symbol}</b><span>$${t.price.toFixed(2)}</span></div>`;
      });
      document.getElementById("token-list").innerHTML = html;
    }

    // Render Trade
    function renderTrade() {
      let sel = document.getElementById("token-select");
      sel.innerHTML = "";
      tokens.forEach(t => {
        sel.innerHTML += `<option value="${t.symbol}">${t.symbol}</option>`;
      });
      drawChart();
    }

    // Draw fake chart
    function drawChart() {
      let canvas = document.getElementById("chart");
      let ctx = canvas.getContext("2d");
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.strokeStyle = "#00c2ff";
      ctx.beginPath();
      if(chartData.length === 0) {
        chartData = Array.from({length:20},()=>Math.random()*100);
      }
      chartData.forEach((val,i) => {
        let x = i*(canvas.width/20);
        let y = canvas.height - (val/100*canvas.height);
        if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
    }

    // Buy
    function buyToken() {
      let amt = parseFloat(document.getElementById("trade-amount").value);
      let token = document.getElementById("token-select").value;
      let t = tokens.find(x=>x.symbol===token);
      if(amt>user.balance) return document.getElementById("trade-msg").innerHTML = "<p class='error'>Not enough balance</p>";
      let qty = amt/t.price;
      user.balance -= amt;
      if(!user.holdings[token]) user.holdings[token]=0;
      user.holdings[token]+=qty;
      saveUser();
      document.getElementById("trade-msg").innerHTML = "<p class='success'>Buy successful</p>";
      renderAssets();
    }

    // Sell
    function sellToken() {
      let amt = parseFloat(document.getElementById("trade-amount").value);
      let token = document.getElementById("token-select").value;
      let t = tokens.find(x=>x.symbol===token);
      let qty = amt/t.price;
      if(!user.holdings[token] || user.holdings[token]<qty) return document.getElementById("trade-msg").innerHTML = "<p class='error'>Not enough holdings</p>";
      user.holdings[token]-=qty;
      user.balance+=amt;
      saveUser();
      document.getElementById("trade-msg").innerHTML = "<p class='success'>Sell successful</p>";
      renderAssets();
    }

    // Save user to localStorage
    function saveUser() {
      localStorage.setItem("user-"+user.username, JSON.stringify(user));
    }

    // Render Assets
    function renderAssets() {
      if(!user) return;
      document.getElementById("balance").innerHTML = "<b>Balance:</b> $"+user.balance.toFixed(2);
      let h = "";
      for(let k in user.holdings) {
        h += `<p>${k}: ${user.holdings[k].toFixed(4)}</p>`;
      }
      document.getElementById("holdings").innerHTML = h;
    }

    // Render Profile
    function renderProfile() {
      if(!user) return;
      document.getElementById("user-info").innerHTML = `<p><b>User:</b> ${user.username}</p>`;
    }

    // Random pump/dump
    setInterval(()=>{
      tokens.forEach(t=>{
        let change = (Math.random()-0.5)*5;
        t.price = Math.max(0.1, t.price + change);
      });
      renderMarket();
      drawChart();
    },3000);

    // Auto login if session
    window.onload=()=>{
      let cu = localStorage.getItem("current-user");
      if(cu) {
        user = JSON.parse(localStorage.getItem("user-"+cu));
        document.getElementById("login").classList.remove('show');
        showPage('market');
      }
    }
  </script>
</body>
</html>
